services:
  relay-pulse:
    build:
      context: .
      dockerfile: Dockerfile
    image: relay-pulse:latest
    container_name: relay-pulse
    restart: unless-stopped

    ports:
      - "8080:8080"

    volumes:
      # 配置文件挂载（必需）
      - ./config.yaml:/app/config.yaml:ro
      # 数据目录（用于 !include 引用的 JSON 文件）
      - ./data:/app/data:ro
      # SQLite 数据库持久化
      - relay-pulse-data:/app

    environment:
      # 时区设置
      - TZ=Asia/Shanghai
      # API 密钥可以通过环境变量覆盖
      # - MONITOR_88CODE_CC_API_KEY=your-api-key
      # - MONITOR_DUCKCODING_CC_API_KEY=your-api-key

    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/health"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s

    networks:
      - relay-pulse-network

volumes:
  relay-pulse-data:
    driver: local

networks:
  relay-pulse-network:
    driver: bridge
